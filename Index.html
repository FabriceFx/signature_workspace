<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Générateur de signature</title>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      corePlugins: {
        preflight: false
      }
    }
  </script>

  <?!= include('Stylesheet'); ?>
</head>

<body>

  <!-- LOADING OVERLAY -->
  <div id="loading-overlay">
    <div class="preloader-wrapper big active">
      <div class="spinner-layer spinner-blue-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
    <p style="margin-top:15px; color:#666; font-weight: 500;">Chargement de vos données...</p>
  </div>

  <!-- NAVBAR (Mobile only mostly) -->
  <header>
    <nav class="white" role="navigation">
      <div class="nav-wrapper" style="padding: 0 20px;">
        <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        <!-- Logo moved to Sidebar -->
        <ul class="right hide-on-med-and-down">
          <li><a href="#" id="user-welcome"></a></li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- SIDEBAR -->
  <ul id="slide-out" class="sidenav sidenav-fixed">
    <li class="logo-container bg-white"
      style="padding: 20px; display: flex; justify-content: space-between; align-items: center;">
      <h5 class="!flex !items-center !text-[#045973] !text-2xl !font-bold !m-0">
        <i class="material-icons mr-2">fingerprint</i> Signature
      </h5>
      <div class="lang-switcher">
        <span class="lang-btn active" onclick="setLanguage('fr')">FR</span>
        <span class="lang-btn" onclick="setLanguage('en')">EN</span>
      </div>
    </li>
    <li class="sidebar-section">
      <h5 class="!text-[#045973] !text-lg !font-semibold !mb-4" data-i18n="sidebar_template">Modèle</h5>
      <div class="input-field">
        <select id="template-select" onchange="onTemplateChange()">
          <option value="" disabled selected data-i18n="loading">Chargement...</option>
        </select>
        <label data-i18n="sidebar_choice">Choix du modèle</label>
      </div>

      <!-- Auto Update Switch -->
      <div class="switch" style="margin-top: 20px;">
        <label>
          <input type="checkbox" id="switch-auto-update" onchange="onAutoUpdateChange()">
          <span class="lever"></span>
          <span class="text-slate-600 text-sm" data-i18n="lbl_auto_update">Mise à jour auto (Nuit)</span>
        </label>
      </div>

      <? if (isAdmin) { ?>
      <div class="admin-actions center-align">
        <button class="btn-small waves-effect waves-light white grey-text text-darken-2 btn-small-icon" id="btn-edit"
          onclick="openAdminEdit('EDIT')" disabled title="Modifier">
          <i class="material-icons">edit</i>
        </button>
        <button class="btn-small waves-effect waves-light white grey-text text-darken-2 btn-small-icon" id="btn-dup"
          onclick="duplicateCurrentTemplate()" disabled title="Dupliquer">
          <i class="material-icons">content_copy</i>
        </button>
        <button class="btn-small waves-effect waves-light white red-text btn-small-icon" id="btn-del"
          onclick="deleteCurrentTemplate()" disabled title="Supprimer">
          <i class="material-icons">delete</i>
        </button>
        <button class="btn-small waves-effect waves-light blue white-text btn-small-icon" onclick="openAdminEdit('NEW')"
          title="Nouveau">
          <i class="material-icons">add</i>
        </button>
      </div>
      <? } ?>
    </li>

    <li class="sidebar-section">
      <h5 class="!text-[#045973] !text-lg !font-semibold !mb-4" data-i18n="sidebar_info">Mes Informations</h5>
      <form id="user-form" oninput="updatePreviewLive()">

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s6">
            <input id="inp-firstName" type="text" class="validate">
            <label for="inp-firstName" data-i18n="lbl_firstname">Prénom</label>
          </div>
          <div class="input-field col s6">
            <input id="inp-lastName" type="text" class="validate">
            <label for="inp-lastName" data-i18n="lbl_lastname">Nom</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-title" type="text" class="validate">
            <label for="inp-title" data-i18n="lbl_job">Fonction</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-company" type="text" placeholder="Ex: Ma Société" class="validate">
            <label for="inp-company" data-i18n="lbl_company">Société</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-costCenter" type="text" placeholder="Ex: Centre de coût" class="validate">
            <label for="inp-costCenter" data-i18n="lbl_cost_center">Centre de coût</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-department" type="text" class="validate">
            <label for="inp-department" data-i18n="lbl_department">Service</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s6">
            <input id="inp-mobile" type="text" class="validate">
            <label for="inp-mobile" data-i18n="lbl_mobile">Mobile</label>
          </div>
          <div class="input-field col s6">
            <input id="inp-phone" type="text" class="validate">
            <label for="inp-phone" data-i18n="lbl_phone">Fixe</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-email" type="text" readonly disabled style="color:#999">
            <label for="inp-email" data-i18n="lbl_email">Email</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-address" type="text" class="validate">
            <label for="inp-address" data-i18n="lbl_address">Adresse</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-banner" type="text" class="validate" placeholder="https://...">
            <label for="inp-banner" data-i18n="lbl_banner">Bannière (URL optionnelle)</label>
          </div>
        </div>

        <div class="row" style="margin-bottom: 0;">
          <div class="input-field col s12">
            <input id="inp-bannerLink" type="text" class="validate" placeholder="https://...">
            <label for="inp-bannerLink" data-i18n="lbl_banner_link">Lien de la bannière (Optionnel)</label>
          </div>
        </div>

      </form>
    </li>
  </ul>

  <!-- MAIN CONTENT -->
  <main>
    <div class="container" style="margin-bottom: 20px;">
      <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
        <h5 class="!text-[#045973] !text-lg !font-semibold !mb-4" data-i18n="how_title">Comment ça marche ?</h5>
        <ol class="text-slate-600 text-sm space-y-2 list-decimal pl-5">
          <li data-i18n="how_step1">Sélectionnez un <b class="text-[#045973]">modèle</b> dans la barre latérale.</li>
          <li data-i18n="how_step2">Vérifiez et corrigez vos <b class="text-[#045973]">informations</b> si nécessaire.
          </li>
          <li data-i18n="how_step3">Cliquez sur le bouton <b><i
                class="tiny material-icons align-middle text-[#E91E63]">save_alt</i></b> en
            bas
            à droite pour appliquer la signature.</li>
        </ol>
      </div>
    </div>

    <div class="preview-wrapper">
      <div class="email-header">
        <div class="dot red"></div>
        <div class="dot yellow"></div>
        <div class="dot green"></div>
      </div>
      <div class="email-body">
        <p style="color:#999; margin-bottom: 30px;">
          Bonjour,<br><br>
          Ceci est un aperçu en temps réel de votre signature.<br>
          Veuillez sélectionner un modèle dans le menu de gauche.<br><br>
          Cordialement,
        </p>

        <div id="signature-preview" style="border-top: 1px dotted #ccc; padding-top: 20px;">
          <!-- Signature Content -->
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-white border-t border-slate-200 py-10 mt-auto"
    style="padding-left: var(--sidebar-width); transition: padding-left .3s;">
    <div class="max-w-6xl mx-auto px-4 text-center">

      <div class="mb-6">
        <a href="https://paypal.me/FFaucheux" target="_blank" rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-slate-50 text-slate-500 hover:bg-yellow-50 hover:text-yellow-700 hover:border-yellow-200 border border-transparent transition-all duration-300 text-xs font-medium group"
          style="text-decoration:none;">
          <i class="fas fa-mug-hot group-hover:animate-bounce"></i>
          <span data-i18n="footer_coffee">Offrez-moi un café</span>
        </a>
      </div>

      <p class="text-slate-500 text-sm">
        ©
        <script>document.write(new Date().getFullYear())</script> <strong>Fabrice Faucheux</strong> — <span
          data-i18n="footer_rights">Tous droits réservés</span>
      </p>

      <div class="mt-4 flex justify-center gap-4">
        <a href="https://www.linkedin.com/in/fabricefaucheux" class="text-slate-400 hover:text-blue-600 transition"
          aria-label="LinkedIn"><i class="fab fa-linkedin text-xl"></i></a>
        <a href="https://atelier-informatique.com/" class="text-slate-400 hover:text-blue-600 transition"
          aria-label="Website"><i class="fas fa-globe text-xl"></i></a>
      </div>
    </div>
  </footer>

  <!-- FAB: Apply Button -->
  <div class="fab-container">
    <button id="btn-apply" class="btn-floating btn-large waves-effect waves-light shadow-effect disabled"
      onclick="applySignature()">
      <i class="material-icons">save_alt</i>
    </button>
  </div>

  <!-- ADMIN MODAL -->
  <? if (isAdmin) { ?>
  <div id="modal-admin" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4 style="color: var(--primary-color);">Éditeur de Modèle</h4>
      <input type="hidden" id="edit-id">

      <div class="row">
        <div class="input-field col s6">
          <input id="edit-name" type="text">
          <label for="edit-name">Nom du modèle</label>
        </div>
        <div class="input-field col s6">
          <input id="edit-logoUrl" type="text">
          <label for="edit-logoUrl">Logo URL (défaut si vide)</label>
          <span class="helper-text">Laissez vide pour utiliser le logo par défaut.</span>
        </div>
      </div>

      <div class="row">
        <div class="col s12">
          <label style="font-size:1rem;">Code HTML</label>
          <textarea id="edit-html" class="materialize-textarea"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="modal-close waves-effect waves-green btn-flat">Annuler</button>
      <button type="button" onclick="saveTemplateToSheet()" id="btn-save-modal"
        class="waves-effect waves-light btn">Enregistrer</button>
    </div>
  </div>

  <!-- Scripts for TinyMCE -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/tinymce.min.js" referrerpolicy="origin"></script>
  <? } ?>

  <!-- Load JavaScript logic -->
  <script>
    var SERVER_DATA = {
      isAdmin: <?= isAdmin ? 'true' : 'false' ?>,
      defaultLogoUrl: "<?= defaultLogoUrl ?>"
    };
  </script>
  <?!= include('JavaScript'); ?>

</body>

</html>